---
layout: blog
status: publish
published: true
title: 'Vagrant : mes premiers pas'
author:
  display_name: SÃ©verin Bruhat
  login: admin_sbr
  email: sbruhat@gmail.com
  url: https://severin-bruhat.com
author_login: admin_sbr
author_email: sbruhat@gmail.com
author_url: https://severin-bruhat.com
wordpress_id: 485
wordpress_url: http://severin-bruhat.com/?p=485
date: '2014-06-27 07:17:53 +0100'
date_gmt: '2014-06-27 06:17:53 +0100'
categories:
- Tutoriels
tags:
- industrialisation
comments: []
---
<a class="link-back" href="/blog/"><< Back to the list</a>
<h1>Vagrant : mes premiers pas</h1>

<h2>
	Pr&eacute;sentation<br />
</h2>
<p>
	Vagrant est un outil permettant de g&eacute;n&eacute;rer des machines virtuelles. Il permet notamment de facilement cr&eacute;er une VM que vous pouvez&nbsp;<span style="line-height: 1.6em;">utiliser dans votre environnement de d&eacute;veloppement. &nbsp;Ainsi, si vous d&eacute;veloppez sur Windows, vous pouvez tester votre application&nbsp;</span><span style="line-height: 1.6em;">sous Linux par exemple, voir m&ecirc;me sur un environnement ISO aux environements de recette, pr&eacute;production et production.</span></p>
<p style="text-align:center">
	<img alt="logo Vagrant" class="alignnone" src="http://www.vagrantup.com/images/logo_vagrant-81478652.png" style="width: 248px; height: 64px;" /></p>
<p>
	Vagrant utilise VirtualBox pour la&nbsp;virtualisation, mais il est &eacute;galement possible d&#39;utiliser d&#39;autres&nbsp;providers (<a href="http://docs.vagrantup.com/v2/getting-started/providers.html" target="_blank">http://docs.vagrantup.com/v2/getting-started/providers.html</a>).</p>
<h2>
	Pr&eacute;requis<br />
</h2>
<ul>
<li>
		disposer de Vagrant : <a href="http://www.vagrantup.com/downloads.html" target="_blank">http://www.vagrantup.com/downloads.html</a>
	</li>
<li>
		disposer de VirtualBox : <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank">https://www.virtualbox.org/wiki/Downloads</a>
	</li>
<li>
		disposer d&#39;un client ssh (cygwin sur windows par exemple : <a href="https://cygwin.com/install.html" target="_blank">https://cygwin.com/install.html</a>)
	</li>
</ul>
<h2>
	Utilisation<br />
</h2>
<p>
	Il existe diff&eacute;rentes boxes packag&eacute;es pour vagrant, vous en trouverez &agrave; ces adresses : <a href="http://www.vagrantbox.es/" target="_blank">http://www.vagrantbox.es/</a>, <a href="https://vagrantcloud.com/discover/featured" target="_blank">https://vagrantcloud.com/discover/featured</a>.&nbsp;Pour ce tuto, nous allons installer une VM bas&eacute;e sur une distribution Debian 7 (64bit) disponible sur http://www.vagrantbox.es.</p>
<p>
	Positionnez vous dans le r&eacute;pertoire courant du projet dans lequel vous souhaitez utiliser vagrant et saisissez la commande :</p>
<pre>
<code>vagrant init chef/debian-7.4

<span style="font-family: sans-serif, Arial, Verdana, 'Trebuchet MS'; line-height: 1.6em;">Cette commande va g&eacute;n&eacute;rer un fichier "Vagrantfile" permettant de configurer la VM. A ce stade, cette derni&egrave;re n&#39;est pas encore&nbsp;</span></code><span style="font-family: sans-serif, Arial, Verdana, 'Trebuchet MS'; line-height: 1.6em;">cr&eacute;&eacute;e. </span><span style="font-family: sans-serif, Arial, Verdana, 'Trebuchet MS'; line-height: 1.6em;">Ex&eacute;cutez ensuite la commande&nbsp;:</span></pre>
<pre>
<code>vagrant up
</code></pre>
<p>
	Cette commande va lancer l&#39;installation de la VM. Celle-ci&nbsp;va &ecirc;tre t&eacute;l&eacute;charg&eacute;e et d&eacute;pos&eacute;e dans votre r&eacute;pertoire de VM&nbsp;<span style="line-height: 1.6em;">configur&eacute; au niveau de votre VirtualBox. cette &eacute;tape peut durer une 20aine de minutes en fonction de votre connexion internet.&nbsp;</span><span style="line-height: 1.6em;">Une fois t&eacute;l&eacute;charg&eacute;e, vous verrez votre VM apparaitre dans la liste de vos machines disponibles dans VirtualBox&nbsp;:</span></p>
<p>
	<a href="/blog-images/2014/06/virtualbox.png"><img alt="virtualbox" class="aligncenter size-medium wp-image-494" height="130" src="/blog-images/2014/06/virtualbox-300x130.png" width="300" /></a></p>
<p>
	La machine est maintenant lanc&eacute;e, vous remarquerez qu&#39;une redirection de port (22 -> 2222) a &eacute;t&eacute; faite pour acc&eacute;der &agrave; la machine en ssh :</p>
<p>
	<a href="/blog-imagesligncenter size-medium wp-image-493" height="79" src="/blog-images/2014/06/mappingssh-30/blog-images/blog-images
<p>
	Vous pouvez ainsi vous connecter en ssh &agrave; la VM gr&acirc;ce &agrave; la commande&nbsp;</p>
<pre>
<code>vagrant ssh
</code></pre>
<p>
	<a href="/blog-imagesize-medium wp-image-492" height="75" src="/blog-images/2014/06/vagrantssh-30/blog-images/blog-images
<p>
	L&#39;authtification est g&eacute;r&eacute;e via une cl&eacute; ssh, vous n&#39;avez ainsi besoin d&#39;aucun mot de passe. Vous avez &eacute;galement acc&egrave;s &agrave; la&nbsp;<span style="line-height: 1.6em;">commande "sudo".</span></p>
<p>
	<strong>Voil&agrave;, c&#39;est aussi simple que &ccedil;a, votre VM est op&eacute;rationnelle !</strong></p>
<h2>
	Quelques commandes utiles :<br />
</h2>
<ul>
<li>
		Pour ajouter une box :&nbsp;vagrant box add nom_de_ma_box url_de_la_box
	</li>
<li>
		<span style="line-height: 1.6em;">Pour supprimer une box :&nbsp;</span><span style="line-height: 1.6em;">vagrant box remove nom_de_ma_box</span>
	</li>
<li>
		Pour lister les box existantes :&nbsp;vagrant box list
	</li>
<li>
		Pour lancer la machine virtuelle :&nbsp;vagrant up
	</li>
<li>
		Pour se connecter en SSH &nbsp;&agrave; la VM :&nbsp;vagrant ssh
	</li>
<li>
		Pour mettre la VM en veille prolong&eacute;e :&nbsp;vagrant suspend
	</li>
<li>
		Pour arr&ecirc;ter la VM :&nbsp;vagrant halt
	</li>
<li>
		Pour relancer la VM :&nbsp;vagrant resume
	</li>
</ul>
<p>
	Vous trouverez la liste compl&egrave;te des commandes &agrave; cette adresse : <a href="http://docs.vagrantup.com/v2/cli/index.html" target="_blank">http://docs.vagrantup.com/v2/cli/index.html</a>.</p>
<h2>
	Pour aller plus loin<br />
</h2>
<p>
	La force de Vagrant ne r&eacute;side pas simplement dans le fait qu&#39;il permette de mettre en place rapidement des VM pour vos projets,&nbsp;mais c&#39;est surtout qu&#39;il permet de configurer et provisioner ces machines virtuelles.&nbsp;En effet, gr&acirc;ce &agrave; Vagrant, vous aller pouvoir sp&eacute;cifier les ressources de la VM (RAM, nombre de coeurs), les redirections de&nbsp;port, les applicatifs &agrave; installer etc.&nbsp;</p>
<p>
	Si vous ne voyez pas l&#39;int&eacute;r&ecirc;t, dites vous que gr&acirc;ce &agrave; un Vagrantfile bien configur&eacute;, un utilisateur peut&nbsp;lancer une VM contenant vim, htop, apache (ou nginx), mysql, PHP (ruby, python etc.), un vhost pointant vers son r&eacute;pertoire de source (en local sur son&nbsp;poste)... avec un simple "vagrant up". C&#39;est pas bon &ccedil;a ? :)</p>
<p>
	Vous trouverez ici les diff&eacute;rents &eacute;l&eacute;ments param&eacute;trable via le Vagrantfile : <a href="http://docs.vagrantup.com/v2/vagrantfile/index.html" target="_blank">http://docs.vagrantup.com/v2/vagrantfile/index.html</a><br />
	Pour disposer d&#39;une VM disposant de &nbsp;1Go de RAM et de 2 coeurs, placer simplement ces lignes dans votre Vagrantfile :</p>
<pre>
<code>config.vm.provider :virtualbox do |vb|
&nbsp; &nbsp; vb.customize ["modifyvm", :id, "--memory", "1024"]
&nbsp;&nbsp; &nbsp;vb.customize ["modifyvm", :id, "--cpus", "2"]
end
</code></pre>
<p>
	Pour le provisioning, plusieurs modes sont disponibles, voici les principaux (liste compl&egrave;te :&nbsp;<span style="line-height: 1.6em;"><a href="http://docs.vagrantup.com/v2/provisioning/index.html" target="_blank">http://docs.vagrantup.com/v2/provisioning/index.html</a>) :</span></p>
<ul>
<li>
		CFEngine (<a href="http://cfengine.com/" target="_blank">http://cfengine.com/</a>)
	</li>
<li>
		Puppet (<a href="http://puppetlabs.com/" target="_blank">http://puppetlabs.com/</a>)
	</li>
<li>
		Chef (<a href="http://www.getchef.com/chef/" target="_blank">http://www.getchef.com/chef/</a>)
	</li>
<li>
		Docker (<a href="http://www.docker.com/" target="_blank">http://www.docker.com/</a>)
	</li>
<li>
		Shell
	</li>
</ul>
<p>
	J&#39;utilise pour ma part un provisionning Chef ou Shell.&nbsp;Vous pouvez par exemple cr&eacute;er un fichier "provisioning.sh" contenant l&#39;ensemble de vos instructions d&#39;installation (apt-get&nbsp;install htop ...) et l&#39;appeler dans le Vagrantfile de cette mani&egrave;re :</p>
<pre>
<code>Vagrant.configure("2") do |config|
&nbsp; &nbsp; config.vm.provision "shell", path: "provisioning.sh"&nbsp;
end
</code></pre>
<p>
	Si vous disposer d&#39;un cookbook Chef :</p>
<pre>
<code>config.vm.provision "chef_solo" do |chef|
&nbsp; &nbsp; chef.cookbooks_path = "provisioning/cookbooks"
&nbsp; &nbsp; chef.json = {
&nbsp;&nbsp;&nbsp; &nbsp;//vos variables&nbsp;
&nbsp; &nbsp; }
&nbsp; &nbsp; chef.add_recipe "myRecipe"
end
</code> </pre>
<p>
	Dans un prochain article je vous pr&eacute;senterai <a href="http://www.getchef.com/chef/" target="_blank">Chef</a>.</p>
<p>
	Une fois votre Vagrantfile modifier, vous pouvez "provisioner" votre VM gr&acirc;ce &agrave; la commande :</p>
<pre>
<code>vagrant provision
</code></pre>
<p>
	<u style="font-size: 13px;">Remarque 1&nbsp;:&nbsp;</u>dans certains cas, il peut &ecirc;tre n&eacute;cessaire de red&eacute;marrer la VM avant de lancer le provisioning pour que toutes les modifications soient prises en compte.</p>
<p>
	<u>Remarque 2 :</u> si vous effectuez des modifications de configuration &agrave; la main sur votre VM (edition du php.ini via ssh par exemple), lors du processus de provisioning, ces derni&egrave;res seront perdues (si le provisioning concerne php &eacute;videmment).</p>
<p>
	Cette article est termin&eacute;, j&#39;esp&egrave;re qu&#39;il vous a plu. N&#39;h&eacute;sitez pas &agrave; laisser un commentaire, publier des liens vers des Vagrantfiles ou des articles similaires/compl&eacute;mentaires.&nbsp;</p>
